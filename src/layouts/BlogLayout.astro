---
/**
 * BlogLayout - Editorial Blog Post Template
 *
 * A refined reading experience with:
 * - Dark hero with post metadata
 * - Optimized typography for long-form content
 * - Reading progress indicator
 * - Related posts section
 */
import BaseLayout from "./BaseLayout.astro";
import Header from "../components/navigation/Header.astro";
import Footer from "../components/navigation/Footer.astro";
import CTABar from "../components/ui/CTABar.astro";
import Container from "../components/ui/Container.astro";

interface Props {
  title: string;
  description: string;
  date: string;
  author: string;
  category: string;
  tags?: string[];
}

const { title, description, date, author, category, tags = [] } = Astro.props;

// Format date
const formattedDate = new Date(date).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

// Calculate reading time (rough estimate)
const content = await Astro.slots.render("default");
const wordCount = content.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);
---

<BaseLayout title={`${title} - Cirries Blog`} description={description}>
  <Header variant="dark" />

  <main class="blog-post" id="main-content">
    <!-- Hero Section -->
    <section class="post-hero">
      <div class="post-hero__background">
        <div class="post-hero__gradient"></div>
        <div class="post-hero__grid"></div>
        <div class="post-hero__noise"></div>
      </div>

      <Container size="lg" class="post-hero__container">
        <div class="post-hero__content">
          <!-- Breadcrumb -->
          <nav class="post-breadcrumb" aria-label="Breadcrumb">
            <a href="/blog" class="breadcrumb-link">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M19 12H5M12 19l-7-7 7-7"></path>
              </svg>
              Back to Blog
            </a>
          </nav>

          <!-- Category Badge -->
          <span class="post-category">{category}</span>

          <!-- Title -->
          <h1 class="post-title">{title}</h1>

          <!-- Meta -->
          <div class="post-meta">
            <div class="post-meta__item">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span>{formattedDate}</span>
            </div>
            <div class="post-meta__divider"></div>
            <div class="post-meta__item">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span>{readingTime} min read</span>
            </div>
            <div class="post-meta__divider"></div>
            <div class="post-meta__item">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              <span>{author}</span>
            </div>
          </div>
        </div>
      </Container>

      <!-- Reading Progress Bar -->
      <div class="reading-progress" id="reading-progress"></div>
    </section>

    <!-- Article Content -->
    <article class="post-content" data-theme="light">
      <!-- Grid Background -->
      <div class="post-content__bg">
        <div class="post-content__gradient"></div>
        <div class="post-content__grid"></div>
      </div>

      <Container size="lg">
        <div class="post-body prose">
          <slot />
        </div>

        <!-- Tags -->
        {
          tags.length > 0 && (
            <div class="post-tags">
              <span class="post-tags__label">Topics:</span>
              <div class="post-tags__list">
                {tags.map((tag) => (
                  <span class="post-tag">{tag}</span>
                ))}
              </div>
            </div>
          )
        }

        <!-- Share Section -->
        <div class="post-share">
          <span class="post-share__label">Share this article</span>
          <div class="post-share__buttons">
            <a
              href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="share-button"
              aria-label="Share on Twitter"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
                ></path>
              </svg>
            </a>
            <a
              href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="share-button"
              aria-label="Share on LinkedIn"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
                ></path>
              </svg>
            </a>
            <button
              class="share-button"
              onclick="navigator.clipboard.writeText(window.location.href); this.classList.add('copied');"
              aria-label="Copy link"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                ></path>
                <path
                  d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </Container>
    </article>

    <!-- Back to Blog CTA -->
    <section class="post-cta">
      <Container size="lg">
        <a href="/blog" class="back-to-blog">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M19 12H5M12 19l-7-7 7-7"></path>
          </svg>
          <span>Back to all articles</span>
        </a>
      </Container>
    </section>
  </main>

  <CTABar />
  <Footer />
</BaseLayout>

<style>
  /* ============================================
     POST HERO
     ============================================ */
  .post-hero {
    position: relative;
    padding-top: 140px;
    padding-bottom: var(--space-16);
    background: var(--color-bg-primary);
    overflow: hidden;
  }

  .post-hero__background {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .post-hero__gradient {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse 80% 60% at 20% 20%,
      rgba(30, 30, 30, 0.5) 0%,
      transparent 50%
    );
  }

  .post-hero__grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    mask-image: radial-gradient(
      ellipse 90% 80% at 30% 50%,
      black 20%,
      transparent 70%
    );
    -webkit-mask-image: radial-gradient(
      ellipse 90% 80% at 30% 50%,
      black 20%,
      transparent 70%
    );
  }

  .post-hero__noise {
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.03;
    pointer-events: none;
  }

  .post-hero :global(.post-hero__container) {
    position: relative;
    z-index: 1;
  }

  .post-hero__content {
    max-width: 800px;
  }

  /* Breadcrumb */
  .post-breadcrumb {
    margin-bottom: var(--space-6);
  }

  .breadcrumb-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: var(--font-medium);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: rgba(255, 255, 255, 0.6);
    text-decoration: none;
    padding: 8px 14px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .breadcrumb-link:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
  }

  /* Category */
  .post-category {
    display: inline-block;
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-primary, #ea242b);
    margin-bottom: var(--space-4);
  }

  /* Title */
  .post-title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 3.25rem);
    font-weight: var(--font-bold);
    line-height: 1.15;
    letter-spacing: -0.02em;
    color: var(--color-text-primary);
    margin-bottom: var(--space-6);
  }

  /* Meta */
  .post-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-4);
  }

  .post-meta__item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .post-meta__item svg {
    width: 16px;
    height: 16px;
    opacity: 0.7;
  }

  .post-meta__divider {
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
  }

  /* Reading Progress */
  .reading-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(
      90deg,
      var(--color-primary) 0%,
      var(--color-primary-hover) 100%
    );
    z-index: 9999;
    transition: width 0.1s ease-out;
  }

  /* ============================================
     POST CONTENT
     ============================================ */
  .post-content {
    position: relative;
    padding: var(--space-16) 0 var(--space-20);
    background: #ffffff;
    overflow: hidden;
  }

  /* Grid Background - prominent from top, fades to bottom */
  .post-content__bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .post-content__gradient {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse 100% 50% at 50% 0%,
      rgba(245, 245, 245, 0.9) 0%,
      transparent 60%
    );
  }

  .post-content__grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(0, 0, 0, 0.035) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 0, 0, 0.035) 1px, transparent 1px);
    background-size: 60px 60px;
    mask-image: linear-gradient(
      to bottom,
      transparent 0%,
      black 5%,
      black 15%,
      transparent 50%
    );
    -webkit-mask-image: linear-gradient(
      to bottom,
      transparent 0%,
      black 5%,
      black 15%,
      transparent 50%
    );
  }

  /* Prose Styling */
  .post-body {
    position: relative;
    z-index: 1;
    font-family: var(--font-body);
    font-size: 1.125rem;
    line-height: 1.85;
    color: #333333;
  }

  .post-body :global(h2) {
    font-family: var(--font-display);
    font-size: clamp(1.5rem, 3vw, 1.875rem);
    font-weight: var(--font-bold);
    color: #0a0a0a;
    margin-top: var(--space-12);
    margin-bottom: var(--space-5);
    letter-spacing: -0.01em;
    line-height: 1.3;
  }

  .post-body :global(h3) {
    font-family: var(--font-display);
    font-size: clamp(1.25rem, 2.5vw, 1.5rem);
    font-weight: var(--font-semibold);
    color: #0a0a0a;
    margin-top: var(--space-10);
    margin-bottom: var(--space-4);
    letter-spacing: -0.01em;
    line-height: 1.35;
  }

  .post-body :global(p) {
    margin-bottom: var(--space-5);
    max-width: 80ch;
  }

  .post-body :global(ul),
  .post-body :global(ol) {
    margin-bottom: var(--space-5);
    padding-left: var(--space-8);
    max-width: 80ch;
  }

  .post-body :global(ul) {
    list-style: none;
  }

  .post-body :global(ul li) {
    position: relative;
    margin-bottom: var(--space-3);
    padding-left: var(--space-2);
  }

  .post-body :global(ul li)::before {
    content: "";
    position: absolute;
    left: calc(-1 * var(--space-5));
    top: 0.65em;
    width: 6px;
    height: 6px;
    background: var(--color-primary, #ea242b);
    border-radius: 1px;
    transform: rotate(45deg);
  }

  /* Nested bullets get different style */
  .post-body :global(ul ul li)::before {
    width: 4px;
    height: 4px;
    background: transparent;
    border: 1.5px solid var(--color-primary, #ea242b);
    border-radius: 0;
  }

  .post-body :global(ul ul ul li)::before {
    width: 6px;
    height: 2px;
    background: var(--color-primary, #ea242b);
    border: none;
    border-radius: 1px;
    transform: none;
  }

  .post-body :global(ol) {
    list-style: none;
    counter-reset: ol-counter;
  }

  .post-body :global(ol li) {
    position: relative;
    margin-bottom: var(--space-3);
    padding-left: var(--space-2);
    counter-increment: ol-counter;
  }

  .post-body :global(ol li)::before {
    content: counter(ol-counter);
    position: absolute;
    left: calc(-1 * var(--space-6));
    top: 0;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: var(--font-bold);
    color: var(--color-primary, #ea242b);
    background: rgba(234, 36, 43, 0.08);
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
  }

  .post-body :global(li) {
    margin-bottom: var(--space-2);
  }

  .post-body :global(strong) {
    font-weight: var(--font-semibold);
    color: #0a0a0a;
  }

  .post-body :global(a) {
    color: var(--color-primary, #ea242b);
    text-decoration: underline;
    text-underline-offset: 3px;
    transition: color 0.2s ease;
  }

  .post-body :global(a:hover) {
    color: var(--color-primary-hover);
  }

  .post-body :global(blockquote) {
    margin: var(--space-8) 0;
    padding: var(--space-5) var(--space-6);
    border-left: 4px solid var(--color-primary, #ea242b);
    background: rgba(234, 36, 43, 0.04);
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: #444444;
  }

  .post-body :global(hr) {
    margin: var(--space-12) 0;
    border: none;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(0, 0, 0, 0.1),
      transparent
    );
  }

  .post-body :global(code) {
    font-family: var(--font-mono);
    font-size: 0.9em;
    padding: 2px 6px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 4px;
    color: #c41e24;
  }

  /* Tags */
  .post-tags {
    position: relative;
    z-index: 1;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-3);
    margin-top: var(--space-12);
    padding-top: var(--space-8);
    border-top: 1px solid rgba(0, 0, 0, 0.08);
  }

  .post-tags__label {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #888888;
  }

  .post-tags__list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .post-tag {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: var(--font-medium);
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.04);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: 4px;
    color: #555555;
    transition: all 0.2s ease;
  }

  .post-tag:hover {
    background: rgba(234, 36, 43, 0.08);
    border-color: rgba(234, 36, 43, 0.15);
    color: var(--color-primary);
  }

  /* Share */
  .post-share {
    position: relative;
    z-index: 1;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-4);
    margin-top: var(--space-8);
    padding-top: var(--space-8);
    border-top: 1px solid rgba(0, 0, 0, 0.08);
  }

  .post-share__label {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #888888;
  }

  .post-share__buttons {
    display: flex;
    gap: var(--space-2);
  }

  .share-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(0, 0, 0, 0.04);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: 8px;
    color: #555555;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .share-button:hover {
    background: rgba(234, 36, 43, 0.08);
    border-color: rgba(234, 36, 43, 0.15);
    color: var(--color-primary);
  }

  .share-button.copied {
    background: rgba(34, 197, 94, 0.1);
    border-color: rgba(34, 197, 94, 0.2);
    color: #16a34a;
  }

  .share-button svg {
    width: 18px;
    height: 18px;
  }

  /* Back CTA */
  .post-cta {
    padding: var(--space-12) 0;
    background: #fafafa;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
  }

  .back-to-blog {
    display: inline-flex;
    align-items: center;
    gap: var(--space-3);
    font-family: var(--font-display);
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    color: #0a0a0a;
    text-decoration: none;
    padding: var(--space-4) var(--space-6);
    background: #ffffff;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .back-to-blog:hover {
    border-color: rgba(234, 36, 43, 0.3);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    transform: translateX(-4px);
  }

  .back-to-blog svg {
    width: 18px;
    height: 18px;
    color: var(--color-primary);
  }

  /* ============================================
     RESPONSIVE
     ============================================ */
  @media (max-width: 768px) {
    .post-hero {
      padding-top: 120px;
      padding-bottom: var(--space-12);
    }

    .post-title {
      font-size: clamp(1.75rem, 7vw, 2.25rem);
    }

    .post-meta {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-2);
    }

    .post-meta__divider {
      display: none;
    }

    .post-content {
      padding: var(--space-12) 0 var(--space-16);
    }

    .post-body {
      font-size: 1rem;
    }

    .post-tags,
    .post-share {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>

<script>
  // Reading progress indicator
  document.addEventListener("DOMContentLoaded", () => {
    const progressBar = document.getElementById("reading-progress");
    const article = document.querySelector(".post-content");

    if (progressBar && article) {
      const updateProgress = () => {
        const articleRect = article.getBoundingClientRect();
        const articleTop = articleRect.top + window.scrollY;
        const articleHeight = articleRect.height;
        const windowHeight = window.innerHeight;
        const scrollY = window.scrollY;

        const progress = Math.min(
          Math.max(
            ((scrollY - articleTop + windowHeight * 0.5) / articleHeight) * 100,
            0
          ),
          100
        );

        progressBar.style.width = `${progress}%`;
      };

      window.addEventListener("scroll", updateProgress, { passive: true });
      updateProgress();
    }
  });
</script>

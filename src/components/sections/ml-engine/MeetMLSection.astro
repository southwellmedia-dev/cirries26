---
/**
 * MeetMLSection - "Meet the ML Engine" hero section with neural network visualization
 *
 * Features an animated neural network visualization with orbiting stat nodes,
 * pulsing core, and data particle effects - focused on ML capabilities.
 */
import { Image } from "astro:assets";
import Container from "../../ui/Container.astro";
import Button from "../../ui/Button.astro";
import StatCard from "../../ui/StatCard.astro";

// Import images
import dartLogoLight from "../../../assets/logos/dart-lightmode.svg";

interface Stat {
  value: string;
  label: string;
  icon: string; // SVG path data
}

interface Props {
  eyebrow?: string;
  title?: string;
  highlightText?: string;
  paragraphs?: string[];
  primaryCta?: { label: string; href: string };
  secondaryCta?: { label: string; href: string };
  stats?: Stat[];
}

const {
  eyebrow = "Proprietary Intelligence",
  title = "The Intelligent Machine",
  highlightText = "Behind DART AI",
  paragraphs = [
    "DART AI isn't just applying generic algorithms. Our platform is built on a <strong>proprietary Machine Learning engine</strong> trained specifically on petabytes of network performance data.",
    "It moves beyond simple thresholds and alerts to understand the complex, dynamic behavior of your entire infrastructure.",
    "From establishing intelligent baselines to predicting future capacity needs, our ML engine transforms raw network data into <strong>actionable intelligence</strong>.",
  ],
  primaryCta = {
    label: "Explore DART AI",
    href: "/solutions/intelligent-network-observability/dart-ai",
  },
  secondaryCta = { label: "Request Demo", href: "/contact" },
  stats = [
    {
      value: "Petabytes",
      label: "Training data",
      icon: "M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3z M9 17V7 M15 17V7",
    },
    {
      value: "Real-time",
      label: "Pattern learning",
      icon: "M22 12h-4l-3 9L9 3l-3 9H2",
    },
    {
      value: "Predictive",
      label: "Anomaly detection",
      icon: "M12 2v4 M12 18v4 M4.93 4.93l2.83 2.83 M16.24 16.24l2.83 2.83 M2 12h4 M18 12h4 M4.93 19.07l2.83-2.83 M16.24 7.76l2.83-2.83",
    },
    {
      value: "Automated",
      label: "Root cause analysis",
      icon: "M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2v-4M9 21H5a2 2 0 0 1-2-2v-4",
    },
  ],
} = Astro.props;
---

<section class="meet-ml-section" data-theme="light">
  <!-- Neural background system -->
  <div class="neural-bg">
    <div class="neural-gradient"></div>
    <div class="neural-grid"></div>
    <div class="neural-particles"></div>
    <div class="neural-noise"></div>
  </div>

  <Container size="xl">
    <div class="meet-ml">
      <div class="meet-ml__content">
        <span class="meet-ml__eyebrow">{eyebrow}</span>

        <h2 class="meet-ml__title">{title} <span>{highlightText}</span></h2>

        {paragraphs.map((text) => <p class="meet-ml__text" set:html={text} />)}

        <div class="meet-ml__actions">
          <Button href={primaryCta.href} variant="primary">
            {primaryCta.label}
          </Button>
          <Button href={secondaryCta.href} variant="outline-dark">
            {secondaryCta.label}
          </Button>
        </div>
      </div>

      <!-- Neural Network Visualization -->
      <div class="neural-viz-container">
        <div class="neural-network" id="ml-neural-network">
          <!-- SVG Canvas for connections -->
          <svg
            class="neural-connections"
            id="ml-neural-svg"
            width="100%"
            height="100%"
            preserveAspectRatio="none"
          >
            <defs>
              <linearGradient
                id="mlConnectionGradient"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="0%"
              >
                <stop offset="0%" stop-color="var(--color-primary-0)"></stop>
                <stop offset="50%" stop-color="var(--color-primary-60)"></stop>
                <stop offset="100%" stop-color="var(--color-primary-0)"></stop>
              </linearGradient>
              <filter
                id="mlNodeGlow"
                x="-50%"
                y="-50%"
                width="200%"
                height="200%"
              >
                <feGaussianBlur stdDeviation="3" result="blur"></feGaussianBlur>
                <feMerge>
                  <feMergeNode in="blur"></feMergeNode>
                  <feMergeNode in="SourceGraphic"></feMergeNode>
                </feMerge>
              </filter>
            </defs>
          </svg>

          <!-- Central AI Core -->
          <div class="neural-core" id="ml-neural-core">
            <div class="core-pulse"></div>
            <div class="core-ring core-ring-1"></div>
            <div class="core-ring core-ring-2"></div>
            <div class="core-logo">
              <Image src={dartLogoLight} alt="DART AI" width={80} height={26} />
            </div>
          </div>

          <!-- Stat Nodes -->
          {stats.map((stat, index) => (
            <div class="stat-node-wrapper" data-node-index={index}>
              <StatCard
                icon={stat.icon}
                value={stat.value}
                label={stat.label}
                theme="dark"
                variant="dashed"
                size="md"
              />
            </div>
          ))}

          <!-- Floating data particles -->
          <div class="data-particles" id="ml-data-particles"></div>
        </div>
      </div>
    </div>
  </Container>
</section>

<style>
  /* ========================================
     NEURAL BACKGROUND SYSTEM
     ======================================== */
  .meet-ml-section {
    position: relative;
    padding: var(--space-20) 0;
    background: var(--color-bg-primary);
    overflow: hidden;
  }

  .neural-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .neural-gradient {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(
        ellipse 100% 80% at 80% 40%,
        var(--color-primary-6) 0%,
        transparent 50%
      ),
      radial-gradient(
        ellipse 60% 60% at 20% 80%,
        var(--color-primary-4) 0%,
        transparent 40%
      ),
      radial-gradient(
        ellipse 40% 40% at 90% 90%,
        var(--color-primary-3) 0%,
        transparent 30%
      ),
      linear-gradient(180deg, var(--color-bg-card) 0%, var(--color-bg-secondary) 50%, var(--color-bg-tertiary) 100%);
  }

  .neural-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(var(--color-black-3) 1px, transparent 1px),
      linear-gradient(90deg, var(--color-black-3) 1px, transparent 1px),
      linear-gradient(var(--color-primary-2) 1px, transparent 1px),
      linear-gradient(90deg, var(--color-primary-2) 1px, transparent 1px);
    background-size:
      60px 60px,
      60px 60px,
      15px 15px,
      15px 15px;
    mask-image: radial-gradient(
      ellipse 90% 80% at 70% 50%,
      black 20%,
      transparent 70%
    );
    -webkit-mask-image: radial-gradient(
      ellipse 90% 80% at 70% 50%,
      black 20%,
      transparent 70%
    );
  }

  .neural-particles {
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(
        circle at 20% 30%,
        var(--color-primary-10) 0px,
        transparent 3px
      ),
      radial-gradient(
        circle at 80% 70%,
        var(--color-primary-8) 0px,
        transparent 3px
      ),
      radial-gradient(
        circle at 40% 80%,
        var(--color-black-4) 0px,
        transparent 2px
      ),
      radial-gradient(
        circle at 60% 20%,
        var(--color-black-3) 0px,
        transparent 2px
      );
    animation: neuralParticleDrift 20s ease-in-out infinite;
  }

  @keyframes neuralParticleDrift {
    0%,
    100% {
      transform: translate(0, 0);
    }
    25% {
      transform: translate(10px, -10px);
    }
    50% {
      transform: translate(-5px, 5px);
    }
    75% {
      transform: translate(8px, 8px);
    }
  }

  .neural-noise {
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.025;
    mix-blend-mode: multiply;
  }

  /* ========================================
     MEET ML ENGINE CONTENT
     ======================================== */
  .meet-ml {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-12);
    align-items: center;
  }

  .meet-ml__eyebrow {
    display: inline-block;
    margin-bottom: var(--space-4);
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    color: var(--color-primary);
  }

  .meet-ml__title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: var(--font-bold);
    line-height: 1.2;
    letter-spacing: var(--tracking-tight);
    color: var(--color-text-primary);
    margin-bottom: var(--space-6);
  }

  .meet-ml__title span {
    color: var(--color-primary);
  }

  .meet-ml__text {
    font-family: var(--font-body);
    font-size: var(--text-base);
    line-height: var(--leading-relaxed);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-4);
  }

  .meet-ml__text :global(strong) {
    color: var(--color-text-primary);
    font-weight: var(--font-semibold);
  }

  .meet-ml__actions {
    display: flex;
    gap: var(--space-4);
    margin-top: var(--space-8);
  }

  /* ========================================
     NEURAL NETWORK VISUALIZATION
     ======================================== */
  .neural-viz-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 450px;
  }

  .neural-network {
    position: relative;
    width: 100%;
    max-width: 450px;
    aspect-ratio: 1;
  }

  .neural-connections {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
    overflow: visible;
  }

  :global(.ml-connection-line) {
    stroke: var(--color-primary-50);
    stroke-width: 1.5;
    fill: none;
    stroke-dasharray: 6 4;
    stroke-linecap: round;
    transition: all 0.3s ease;
  }

  :global(.ml-data-pulse) {
    fill: var(--color-primary);
  }

  /* Neural Core */
  .neural-core {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    z-index: 10;
  }

  .core-pulse {
    position: absolute;
    inset: -20px;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      var(--color-primary-15) 0%,
      transparent 70%
    );
    animation: neuralCorePulse 3s ease-in-out infinite;
  }

  @keyframes neuralCorePulse {
    0%,
    100% {
      transform: scale(1);
      opacity: 0.5;
    }
    50% {
      transform: scale(1.2);
      opacity: 0.8;
    }
  }

  .core-ring {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 1px solid var(--color-primary-25);
  }

  .core-ring-1 {
    inset: -10px;
    animation: neuralRingRotate 20s linear infinite;
    border-style: dashed;
    border-color: var(--color-primary-20);
  }

  .core-ring-2 {
    inset: -25px;
    animation: neuralRingRotate 30s linear infinite reverse;
    border-style: dotted;
    border-color: var(--color-primary-12);
  }

  @keyframes neuralRingRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .core-logo {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-white-95);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-radius: 50%;
    border: 1px solid var(--color-black-8);
    box-shadow:
      0 4px 30px var(--color-black-10),
      0 0 40px var(--color-primary-10),
      inset 0 0 30px var(--color-white-50);
    overflow: hidden;
  }

  .core-logo img {
    width: 65%;
    height: auto;
  }

  /* Stat Node Wrappers - positioning for neural network */
  .stat-node-wrapper {
    position: absolute;
    transform: translate(-50%, -50%);
    z-index: 5;
  }

  .stat-node-wrapper:hover {
    z-index: 20;
  }

  /* Stat Node Floating Animations */
  .stat-node-wrapper[data-node-index="0"] {
    animation: nodeFloat0 8s ease-in-out infinite;
  }
  .stat-node-wrapper[data-node-index="1"] {
    animation: nodeFloat1 9s ease-in-out infinite;
  }
  .stat-node-wrapper[data-node-index="2"] {
    animation: nodeFloat2 7s ease-in-out infinite;
  }
  .stat-node-wrapper[data-node-index="3"] {
    animation: nodeFloat3 8.5s ease-in-out infinite;
  }

  @keyframes nodeFloat0 {
    0%, 100% { transform: translate(-50%, -50%) translateY(0) translateX(0); }
    50% { transform: translate(-50%, -50%) translateY(-8px) translateX(4px); }
  }

  @keyframes nodeFloat1 {
    0%, 100% { transform: translate(-50%, -50%) translateY(0) translateX(0); }
    50% { transform: translate(-50%, -50%) translateY(6px) translateX(-6px); }
  }

  @keyframes nodeFloat2 {
    0%, 100% { transform: translate(-50%, -50%) translateY(0) translateX(0); }
    50% { transform: translate(-50%, -50%) translateY(-10px) translateX(-4px); }
  }

  @keyframes nodeFloat3 {
    0%, 100% { transform: translate(-50%, -50%) translateY(0) translateX(0); }
    50% { transform: translate(-50%, -50%) translateY(8px) translateX(5px); }
  }

  /* Data Particles Container */
  .data-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 2;
  }

  :global(.ml-data-particle) {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--color-text-dim);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 var(--space-1-5) var(--color-text-dim);
    pointer-events: none;
  }

  /* ========================================
     RESPONSIVE
     ======================================== */
  @media (max-width: 1024px) {
    .meet-ml {
      grid-template-columns: 1fr;
      gap: var(--space-12);
    }

    .neural-viz-container {
      min-height: 400px;
    }

    .neural-network {
      max-width: 380px;
    }
  }

  @media (max-width: 768px) {
    .meet-ml-section {
      padding: var(--space-12) 0;
    }

    .meet-ml__title {
      font-size: var(--text-2xl);
    }

    .meet-ml__actions {
      flex-direction: column;
    }

    .neural-viz-container {
      min-height: 350px;
    }

    .neural-network {
      max-width: 320px;
    }

    .neural-core {
      width: 90px;
      height: 90px;
    }

    .core-ring-1 {
      inset: -8px;
    }
    .core-ring-2 {
      inset: -18px;
    }
  }
</style>

<script>
  import { initMLNeuralNetwork } from "../../../scripts/neural-network-ml";

  function init(): void {
    setTimeout(initMLNeuralNetwork, 150);
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }

  // Resize handler
  let mlResizeTimeout: ReturnType<typeof setTimeout>;
  window.addEventListener("resize", () => {
    clearTimeout(mlResizeTimeout);
    mlResizeTimeout = setTimeout(initMLNeuralNetwork, 250);
  });
</script>

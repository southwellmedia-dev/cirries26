---
/**
 * CaseStudyChallenge - Problem statement with dramatic pull quote
 *
 * Editorial-style section featuring large typography, offset imagery,
 * and visual problem indicators.
 */
import { Image } from "astro:assets";
import Container from "../../ui/Container.astro";
import hospitalImg from "../../../assets/hospital.jpg";

interface ChallengePoint {
  title: string;
  description: string;
}

interface Props {
  title?: string;
  pullQuote?: string;
  description?: string;
  challengePoints?: ChallengePoint[];
  imageAlt?: string;
}

const {
  title = "The Challenge",
  pullQuote = "Traditional troubleshooting methods were time-consuming and lacked proactive detection capabilities.",
  description = "The company faced persistent issues with jitter and packet loss affecting the performance of critical medical applications. These network inefficiencies led to delays in data transmission, impacting real-time monitoring and device responsiveness.",
  challengePoints = [
    {
      title: "Network Jitter",
      description: "Unpredictable latency variations affecting surgical precision"
    },
    {
      title: "Packet Loss",
      description: "Critical data transmission failures during procedures"
    },
    {
      title: "Manual Diagnosis",
      description: "Hours of investigation with reactive troubleshooting"
    }
  ],
  imageAlt = "Medical technology environment"
} = Astro.props;
---

<section class="case-challenge" data-theme="dark">
  <!-- Background -->
  <div class="case-challenge__bg">
    <div class="case-challenge__gradient"></div>
    <div class="case-challenge__grid"></div>
    <div class="case-challenge__noise"></div>
  </div>

  <Container size="xl">
    <!-- Section Header -->
    <div class="case-challenge__header animate-on-scroll">
      <div class="case-challenge__section-label">
        <span class="case-challenge__label-number">02</span>
        <span class="case-challenge__label-text">{title}</span>
      </div>
    </div>

    <!-- Main Layout -->
    <div class="case-challenge__layout">
      <!-- Pull Quote - Large Typography -->
      <div class="case-challenge__quote-block animate-on-scroll">
        <div class="case-challenge__quote-mark" aria-hidden="true">
          <svg width="120" height="96" viewBox="0 0 120 96" fill="none">
            <path d="M26.4 96C18.8 96 12.4 93.2 7.2 87.6C2.4 82 0 74.8 0 66C0 54.8 3.6 44.4 10.8 34.8C18 25.2 28.8 16.4 43.2 8.4L52.8 22.8C43.2 28 35.6 33.8 30 40.2C24.4 46.2 21.6 52.4 21.6 58.8C21.6 61.2 22.2 63.2 23.4 64.8C27 62.4 31 61.2 35.4 61.2C41.4 61.2 46.4 63.2 50.4 67.2C54.4 71.2 56.4 76.4 56.4 82.8C56.4 88.4 54.2 93 49.8 96.6C45.4 99.8 40.4 96 26.4 96ZM90 96C82.4 96 76 93.2 70.8 87.6C66 82 63.6 74.8 63.6 66C63.6 54.8 67.2 44.4 74.4 34.8C81.6 25.2 92.4 16.4 106.8 8.4L116.4 22.8C106.8 28 99.2 33.8 93.6 40.2C88 46.2 85.2 52.4 85.2 58.8C85.2 61.2 85.8 63.2 87 64.8C90.6 62.4 94.6 61.2 99 61.2C105 61.2 110 63.2 114 67.2C118 71.2 120 76.4 120 82.8C120 88.4 117.8 93 113.4 96.6C109 99.8 104 96 90 96Z" fill="currentColor"/>
          </svg>
        </div>
        <blockquote class="case-challenge__quote">
          {pullQuote}
        </blockquote>
        <div class="case-challenge__quote-line"></div>
      </div>

      <!-- Content Grid -->
      <div class="case-challenge__content">
        <!-- Description -->
        <p class="case-challenge__description animate-on-scroll">
          {description}
        </p>

        <!-- Challenge Points -->
        <div class="case-challenge__points">
          {challengePoints.map((point, index) => (
            <div
              class="case-challenge__point animate-on-scroll"
              style={`animation-delay: ${0.1 * (index + 1)}s`}
            >
              <div class="case-challenge__point-indicator">
                <div class="case-challenge__point-pulse"></div>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <div class="case-challenge__point-content">
                <h4 class="case-challenge__point-title">{point.title}</h4>
                <p class="case-challenge__point-desc">{point.description}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Image Block - Offset -->
      <div class="case-challenge__image-block animate-on-scroll">
        <div class="case-challenge__image-frame">
          <Image
            src={hospitalImg}
            alt={imageAlt}
            class="case-challenge__image"
            loading="lazy"
            quality={80}
          />
          <div class="case-challenge__image-overlay"></div>

          <!-- Problem Indicators -->
          <div class="case-challenge__indicator case-challenge__indicator--1">
            <div class="indicator-ping"></div>
            <span>Jitter Detected</span>
          </div>
          <div class="case-challenge__indicator case-challenge__indicator--2">
            <div class="indicator-ping"></div>
            <span>Packet Loss</span>
          </div>
        </div>

        <!-- Decorative Corner -->
        <div class="case-challenge__corner"></div>
      </div>
    </div>
  </Container>
</section>

<style>
  /* ========================================
     CASE STUDY CHALLENGE - Dark Editorial
     ======================================== */
  .case-challenge {
    position: relative;
    padding: var(--space-24) 0;
    background: var(--color-bg-primary);
    overflow: hidden;
  }

  /* Background System */
  .case-challenge__bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .case-challenge__gradient {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(
        ellipse 80% 60% at 20% 30%,
        rgba(234, 36, 43, 0.08) 0%,
        transparent 50%
      ),
      radial-gradient(
        ellipse 60% 50% at 80% 70%,
        rgba(234, 36, 43, 0.05) 0%,
        transparent 40%
      );
  }

  .case-challenge__grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 60px 60px;
    mask-image: radial-gradient(ellipse at 50% 50%, black 30%, transparent 70%);
  }

  .case-challenge__noise {
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.03;
  }

  /* Section Header */
  .case-challenge__header {
    margin-bottom: var(--space-12);
    position: relative;
    z-index: 1;
  }

  .case-challenge__section-label {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .case-challenge__label-number {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--color-primary);
    letter-spacing: 0.05em;
  }

  .case-challenge__label-text {
    font-family: var(--font-display);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-text-muted);
  }

  /* Layout */
  .case-challenge__layout {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto 1fr;
    gap: var(--space-12);
  }

  .case-challenge__quote-block {
    grid-column: 1 / -1;
    grid-row: 1;
  }

  .case-challenge__content {
    grid-column: 1;
    grid-row: 2;
  }

  .case-challenge__image-block {
    grid-column: 2;
    grid-row: 2;
  }

  /* Pull Quote Block */
  .case-challenge__quote-block {
    position: relative;
    padding-left: var(--space-8);
  }

  .case-challenge__quote-mark {
    position: absolute;
    left: 0;
    top: 0;
    color: rgba(234, 36, 43, 0.08);
    z-index: 0;
    user-select: none;
    pointer-events: none;
  }

  .case-challenge__quote {
    position: relative;
    z-index: 1;
    font-family: var(--font-display);
    font-size: clamp(1.5rem, 3.5vw, 2.5rem);
    font-weight: var(--font-semibold);
    line-height: 1.3;
    letter-spacing: -0.02em;
    color: var(--color-text-primary);
    margin: 0;
    max-width: 900px;
  }

  .case-challenge__quote-line {
    position: relative;
    z-index: 1;
    width: 80px;
    height: 3px;
    background: var(--color-primary);
    margin-top: var(--space-6);
    border-radius: var(--radius-full);
  }

  /* Content Column */
  .case-challenge__content {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    align-self: start;
  }

  .case-challenge__description {
    font-family: var(--font-body);
    font-size: var(--text-lg);
    line-height: var(--leading-relaxed);
    color: var(--color-text-secondary);
  }

  /* Challenge Points */
  .case-challenge__points {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .case-challenge__point {
    display: flex;
    align-items: flex-start;
    gap: var(--space-4);
    padding: var(--space-4);
    background: rgba(234, 36, 43, 0.05);
    border: 1px solid rgba(234, 36, 43, 0.15);
    border-radius: var(--radius-lg);
    transition: all 0.3s ease;
  }

  .case-challenge__point:hover {
    background: rgba(234, 36, 43, 0.08);
    border-color: rgba(234, 36, 43, 0.25);
    transform: translateX(4px);
  }

  .case-challenge__point-indicator {
    position: relative;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(234, 36, 43, 0.15);
    border-radius: var(--radius-md);
    color: var(--color-primary);
    flex-shrink: 0;
  }

  .case-challenge__point-pulse {
    position: absolute;
    inset: 0;
    border-radius: var(--radius-md);
    background: var(--color-primary);
    opacity: 0;
    animation: pointPulse 2s ease-out infinite;
  }

  @keyframes pointPulse {
    0% { transform: scale(1); opacity: 0.4; }
    100% { transform: scale(1.5); opacity: 0; }
  }

  .case-challenge__point-content {
    flex: 1;
  }

  .case-challenge__point-title {
    font-family: var(--font-display);
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--space-1);
  }

  .case-challenge__point-desc {
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    line-height: var(--leading-relaxed);
    margin: 0;
  }

  /* Image Block */
  .case-challenge__image-block {
    position: relative;
    align-self: start;
  }

  .case-challenge__image-frame {
    position: relative;
    border-radius: var(--radius-xl);
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  .case-challenge__image {
    width: 100%;
    height: 400px;
    object-fit: cover;
    filter: grayscale(30%);
    transition: filter 0.5s ease;
  }

  .case-challenge__image-frame:hover .case-challenge__image {
    filter: grayscale(0%);
  }

  .case-challenge__image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      180deg,
      rgba(10, 10, 10, 0.3) 0%,
      rgba(10, 10, 10, 0.1) 50%,
      rgba(10, 10, 10, 0.5) 100%
    );
  }

  /* Problem Indicators */
  .case-challenge__indicator {
    position: absolute;
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-3);
    background: rgba(234, 36, 43, 0.9);
    border-radius: var(--radius-md);
    font-family: var(--font-mono);
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: white;
    box-shadow: 0 4px 20px rgba(234, 36, 43, 0.4);
    animation: indicatorFloat 3s ease-in-out infinite;
  }

  .case-challenge__indicator--1 {
    top: 20%;
    left: 15%;
    animation-delay: 0s;
  }

  .case-challenge__indicator--2 {
    bottom: 25%;
    right: 10%;
    animation-delay: 1.5s;
  }

  @keyframes indicatorFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }

  .indicator-ping {
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    animation: indicatorPing 1.5s ease-out infinite;
  }

  @keyframes indicatorPing {
    0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
    70% { box-shadow: 0 0 0 8px rgba(255, 255, 255, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
  }

  /* Corner Decoration */
  .case-challenge__corner {
    position: absolute;
    bottom: -20px;
    right: -20px;
    width: 80px;
    height: 80px;
    border: 1px solid rgba(234, 36, 43, 0.2);
    border-radius: var(--radius-lg);
    z-index: -1;
  }

  /* Animation states */
  .animate-on-scroll {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .animate-on-scroll.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .case-challenge__layout {
      grid-template-columns: 1fr;
    }

    .case-challenge__quote-mark svg {
      width: 80px;
      height: 64px;
    }

    .case-challenge__image {
      height: 300px;
    }
  }

  @media (max-width: 640px) {
    .case-challenge {
      padding: var(--space-16) 0;
    }

    .case-challenge__quote-mark svg {
      width: 60px;
      height: 48px;
    }

    .case-challenge__indicator {
      font-size: 0.55rem;
      padding: var(--space-1-5) var(--space-2);
    }
  }
</style>

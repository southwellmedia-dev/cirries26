---
/**
 * MeetCPSection - "The Pulse of Network Performance"
 *
 * Connectivity & Performance intro section featuring:
 * - Central globe/pulse visualization with orbiting connectivity domains
 * - Animated signal waves connecting domain nodes
 * - Focus on unified visibility and performance optimization
 */
import Container from "../../ui/Container.astro";
import Button from "../../ui/Button.astro";
import DartLogoLight from "../../../assets/logos/dart-lightmode.svg";

interface Props {
  eyebrow?: string;
  title?: string;
  highlightText?: string;
  paragraphs?: string[];
  primaryCta?: { label: string; href: string };
  secondaryCta?: { label: string; href: string };
}

const {
  eyebrow = "Connectivity & Performance",
  title = "The Pulse Behind",
  highlightText = "Network Excellence.",
  paragraphs = [
    "From mobile networks to cloud environments, from IoT deployments to home broadbandâ€”<strong>every connection tells a story</strong>. Cirries' Connectivity & Performance solutions decode that story, transforming raw network telemetry into actionable intelligence.",
    "We don't just monitor connectivity; we <strong>optimize it, predict failures, and guarantee performance</strong> across every domain. Whether you're managing a 5G rollout or troubleshooting Wi-Fi dead zones, we give you the visibility to act with confidence.",
  ],
  primaryCta = {
    label: "Explore Solutions",
    href: "#solutions",
  },
  secondaryCta = { label: "Request Demo", href: "/contact" },
} = Astro.props;

// Connectivity domain nodes for visualization - all using brand color
const domainNodes = [
  { type: "mobile", label: "Mobile", angle: -60, distance: 155, color: "#EA242B", faIcon: "fa-solid fa-signal", desc: "5G & LTE" },
  { type: "cloud", label: "Cloud", angle: 0, distance: 155, color: "#EA242B", faIcon: "fa-solid fa-cloud", desc: "Multi-Cloud" },
  { type: "iot", label: "IoT", angle: 60, distance: 155, color: "#EA242B", faIcon: "fa-solid fa-microchip", desc: "Connected Devices" },
  { type: "home", label: "Broadband", angle: 120, distance: 155, color: "#EA242B", faIcon: "fa-solid fa-wifi", desc: "Home Wi-Fi" },
  { type: "private", label: "Private Net", angle: 180, distance: 155, color: "#EA242B", faIcon: "fa-solid fa-building", desc: "Enterprise" },
  { type: "transport", label: "Transport", angle: -120, distance: 155, color: "#EA242B", faIcon: "fa-solid fa-network-wired", desc: "Backbone" },
];
---

<section class="meet-cp-section" data-theme="light">
  <!-- Atmospheric Background -->
  <div class="cp-bg">
    <div class="cp-gradient"></div>
    <div class="cp-grid"></div>
    <div class="cp-radial"></div>
  </div>

  <Container size="xl">
    <div class="meet-cp">
      <!-- Left: Content -->
      <div class="meet-cp__content">
        <span class="meet-cp__eyebrow">{eyebrow}</span>

        <h2 class="meet-cp__title">
          {title}
          <span>{highlightText}</span>
        </h2>

        {paragraphs.map((text) => <p class="meet-cp__text" set:html={text} />)}

        <div class="meet-cp__actions">
          <Button href={primaryCta.href} variant="primary">
            {primaryCta.label}
          </Button>
          <Button href={secondaryCta.href} variant="outline-dark">
            {secondaryCta.label}
          </Button>
        </div>
      </div>

      <!-- Right: Network Pulse Visualization -->
      <div class="network-pulse" id="network-pulse">
        <!-- SVG for signal connections -->
        <svg class="pulse-connections" viewBox="0 0 400 400" id="pulse-connections-svg">
          <defs>
            <!-- Animated gradient for signal pathways -->
            <linearGradient id="signal-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color: var(--color-primary-10)">
                <animate attributeName="stop-color" values="var(--color-primary-10);var(--color-primary-40);var(--color-primary-10)" dur="3s" repeatCount="indefinite" />
              </stop>
              <stop offset="50%" style="stop-color: var(--color-primary-40)">
                <animate attributeName="stop-color" values="var(--color-primary-40);var(--color-primary-10);var(--color-primary-40)" dur="3s" repeatCount="indefinite" />
              </stop>
              <stop offset="100%" style="stop-color: var(--color-primary-10)">
                <animate attributeName="stop-color" values="var(--color-primary-10);var(--color-primary-40);var(--color-primary-10)" dur="3s" repeatCount="indefinite" />
              </stop>
            </linearGradient>
            <!-- Glow filter -->
            <filter id="signal-glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          <g id="signal-lines"></g>
          <g id="cross-connections"></g>
        </svg>

        <!-- Central Hub - DART AI Logo -->
        <div class="pulse-hub" id="pulse-hub">
          <div class="hub-energy"></div>
          <div class="hub-orbit hub-orbit-1"></div>
          <div class="hub-orbit hub-orbit-2"></div>
          <div class="hub-orbit hub-orbit-3"></div>
          <div class="hub-core">
            <img src={DartLogoLight.src} alt="DART AI" class="hub-logo" />
            <div class="hub-pulse-ring"></div>
          </div>
        </div>

        <!-- Domain Nodes -->
        {domainNodes.map((node, index) => (
          <a
            href={`/solutions/connectivity-performance/${node.type === 'mobile' ? 'mobile' : node.type === 'cloud' ? 'cloud-monitoring' : node.type === 'home' ? 'home-broadband' : node.type === 'private' ? 'private-network' : node.type}`}
            class={`domain-node domain-node--${node.type}`}
            data-angle={node.angle}
            data-distance={node.distance}
            data-index={index}
            data-color={node.color}
            style={`--node-delay: ${index * 0.15}s; --node-color: ${node.color}`}
          >
            <div class="node-glow"></div>
            <div class="node-icon-wrapper">
              <div class="node-icon">
                <i class={`${node.faIcon} node-fa-icon`}></i>
              </div>
              <div class="node-ring"></div>
            </div>
            <div class="node-info">
              <span class="node-label">{node.label}</span>
              <span class="node-desc">{node.desc}</span>
            </div>
          </a>
        ))}

        <!-- Data flow particles container -->
        <div class="data-particles" id="data-particles"></div>

        <!-- Outer connectivity rings -->
        <div class="connectivity-ring connectivity-ring-1"></div>
        <div class="connectivity-ring connectivity-ring-2"></div>
        <div class="connectivity-ring connectivity-ring-3"></div>
      </div>
    </div>
  </Container>
</section>

<style>
  .meet-cp-section {
    position: relative;
    padding: var(--space-20) 0;
    background: var(--color-bg-primary);
    overflow: hidden;
  }

  .cp-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .cp-gradient {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 90% 70% at 70% 35%, var(--color-primary-5) 0%, transparent 50%),
      radial-gradient(ellipse 60% 50% at 25% 75%, var(--color-primary-3) 0%, transparent 45%),
      radial-gradient(ellipse 50% 40% at 80% 80%, var(--color-primary-3) 0%, transparent 40%),
      linear-gradient(180deg, var(--color-bg-primary) 0%, var(--color-bg-secondary) 50%, var(--color-bg-tertiary) 100%);
  }

  .cp-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(var(--color-black-1) 1px, transparent 1px),
      linear-gradient(90deg, var(--color-black-1) 1px, transparent 1px);
    background-size: 50px 50px;
    mask-image: radial-gradient(ellipse 80% 70% at 60% 50%, black 20%, transparent 70%);
    -webkit-mask-image: radial-gradient(ellipse 80% 70% at 60% 50%, black 20%, transparent 70%);
  }

  .cp-radial {
    position: absolute;
    top: 50%;
    right: 10%;
    transform: translate(0, -50%);
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, var(--color-primary-3) 0%, transparent 60%);
    pointer-events: none;
  }

  /* Content Layout */
  .meet-cp {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-12);
    align-items: center;
  }

  .meet-cp__eyebrow {
    display: inline-block;
    margin-bottom: var(--space-4);
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    color: var(--color-primary, #EA242B);
  }

  .meet-cp__title {
    font-family: var(--font-display);
    font-size: clamp(1.75rem, 3.5vw, 2.75rem);
    font-weight: var(--font-bold);
    line-height: 1.15;
    letter-spacing: var(--tracking-tight);
    color: var(--color-text-primary);
    margin-bottom: var(--space-6);
  }

  .meet-cp__title span {
    display: block;
    color: var(--color-primary, #EA242B);
  }

  .meet-cp__text {
    font-family: var(--font-body);
    font-size: var(--text-base);
    line-height: var(--leading-relaxed);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-4);
  }

  .meet-cp__text :global(strong) {
    color: var(--color-text-primary);
    font-weight: var(--font-semibold);
  }

  .meet-cp__actions {
    display: flex;
    gap: var(--space-4);
    margin-top: var(--space-8);
  }

  /* Network Pulse Visualization */
  .network-pulse {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
    max-width: 520px;
    margin: 0 auto;
  }

  .pulse-connections {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  /* Central Hub */
  .pulse-hub {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 140px;
    height: 140px;
    z-index: 10;
  }

  .hub-energy {
    position: absolute;
    inset: -35px;
    border-radius: 50%;
    background: radial-gradient(circle,
      var(--color-primary-12) 0%,
      var(--color-primary-4) 40%,
      transparent 70%
    );
    animation: energyPulse 4s ease-in-out infinite;
  }

  @keyframes energyPulse {
    0%, 100% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.15); opacity: 1; }
  }

  .hub-orbit {
    position: absolute;
    border-radius: 50%;
    border: 1px solid var(--color-primary-15);
  }

  .hub-orbit-1 {
    inset: -15px;
    animation: orbitRotate 20s linear infinite;
    border-style: dashed;
    border-color: var(--color-primary-12);
  }

  .hub-orbit-2 {
    inset: -35px;
    animation: orbitRotate 30s linear infinite reverse;
    border-style: dotted;
    border-color: var(--color-primary-8);
  }

  .hub-orbit-3 {
    inset: -55px;
    animation: orbitRotate 45s linear infinite;
    border-style: dashed;
    border-width: 1px;
    border-color: var(--color-primary-5);
  }

  @keyframes orbitRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .hub-core {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-bg-primary) 0%, var(--color-bg-tertiary) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 50%;
    border: 2px solid var(--color-primary-15);
    box-shadow:
      0 16px 48px var(--color-black-12),
      0 0 0 1px var(--color-white-90) inset,
      0 0 80px var(--color-primary-8);
    z-index: 12;
  }

  .hub-logo {
    width: 65%;
    height: auto;
    object-fit: contain;
  }

  .hub-pulse-ring {
    position: absolute;
    inset: -8px;
    border-radius: 50%;
    border: 2px solid var(--color-primary-30);
    animation: hubRingPulse 2s ease-out infinite;
  }

  @keyframes hubRingPulse {
    0% { transform: scale(0.9); opacity: 0.8; }
    100% { transform: scale(1.2); opacity: 0; }
  }

  .hub-label {
    position: absolute;
    bottom: -36px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-mono);
    font-size: var(--text-2xs);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-primary, #EA242B);
    white-space: nowrap;
    padding: var(--space-1-5) var(--space-3);
    background: var(--color-primary-8);
    border: 1px solid var(--color-primary-15);
    border-radius: var(--radius-md);
  }

  /* Connectivity Rings */
  .connectivity-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 1px dashed var(--color-primary-6);
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
  }

  .connectivity-ring-1 { width: 70%; height: 70%; }
  .connectivity-ring-2 { width: 85%; height: 85%; }
  .connectivity-ring-3 { width: 98%; height: 98%; border-style: dotted; }

  /* Domain Nodes */
  .domain-node {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    transform: translate(-50%, -50%);
    text-decoration: none;
    opacity: 0;
    animation: nodeAppear 0.6s ease forwards;
    animation-delay: var(--node-delay);
    z-index: 8;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .domain-node:hover {
    transform: translate(-50%, -50%) scale(1.08);
  }

  @keyframes nodeAppear {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }

  .node-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    background: radial-gradient(circle, var(--node-color) 0%, transparent 70%);
    opacity: 0;
    filter: blur(20px);
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .domain-node:hover .node-glow {
    opacity: 0.2;
  }

  .node-icon-wrapper {
    position: relative;
  }

  .node-icon {
    position: relative;
    width: 62px;
    height: 62px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-primary);
    border: 2px solid var(--color-black-6);
    border-radius: 18px;
    box-shadow:
      0 4px 16px var(--color-black-8),
      0 8px 32px var(--color-black-4);
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .domain-node:hover .node-icon {
    border-color: var(--node-color);
    box-shadow:
      0 8px 24px color-mix(in srgb, var(--node-color) 30%, transparent),
      0 12px 40px var(--color-black-10);
  }

  .node-fa-icon {
    font-size: 1.5rem;
    color: var(--node-color);
    transition: all 0.3s ease;
  }

  .domain-node:hover .node-fa-icon {
    transform: scale(1.1);
  }

  .node-ring {
    position: absolute;
    inset: -6px;
    border-radius: 22px;
    border: 2px solid var(--node-color);
    opacity: 0;
    animation: nodeRing 3s ease-out infinite;
    animation-delay: var(--node-delay);
  }

  @keyframes nodeRing {
    0% { transform: scale(0.9); opacity: 0.4; }
    100% { transform: scale(1.3); opacity: 0; }
  }

  .node-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
  }

  .node-label {
    font-family: var(--font-display);
    font-size: var(--text-sm);
    font-weight: var(--font-bold);
    color: var(--color-text-primary);
    transition: color 0.3s ease;
  }

  .domain-node:hover .node-label {
    color: var(--node-color);
  }

  .node-desc {
    font-family: var(--font-mono);
    font-size: var(--text-2xs);
    font-weight: var(--font-medium);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--color-text-muted);
  }

  /* Data Particles */
  .data-particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 6;
  }

  :global(.data-particle) {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    opacity: 0;
    z-index: 9;
  }

  :global(.signal-line) {
    stroke: url(#signal-gradient);
    stroke-width: 2;
    fill: none;
    filter: url(#signal-glow);
    stroke-dasharray: 8 6;
    animation: signalFlow 4s linear infinite;
  }

  @keyframes signalFlow {
    to { stroke-dashoffset: -80; }
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .meet-cp {
      grid-template-columns: 1fr;
      gap: var(--space-12);
    }

    .network-pulse {
      max-width: 450px;
    }
  }

  @media (max-width: 768px) {
    .meet-cp-section {
      padding: var(--space-12) 0;
    }

    .meet-cp__title {
      font-size: var(--text-2xl);
    }

    .meet-cp__actions {
      flex-direction: column;
    }

    .network-pulse {
      max-width: 360px;
    }

    .pulse-hub {
      width: 110px;
      height: 110px;
    }

    .hub-logo {
      width: 60%;
    }

    .hub-orbit-1 { inset: -12px; }
    .hub-orbit-2 { inset: -28px; }
    .hub-orbit-3 { inset: -44px; }

    .hub-label {
      font-size: 0.5rem;
      bottom: -30px;
    }

    .node-icon {
      width: 50px;
      height: 50px;
      border-radius: 14px;
    }

    .node-fa-icon {
      font-size: 1.2rem;
    }

    .node-desc {
      display: none;
    }
  }
</style>

<script>
  // Position domain nodes in orbital layout and create connections
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('network-pulse');
    const svg = document.getElementById('pulse-connections-svg');
    const signalGroup = document.getElementById('signal-lines');

    if (!container || !svg || !signalGroup) return;

    const nodes = container.querySelectorAll('.domain-node');
    const centerX = 200;
    const centerY = 200;

    // Position nodes and create connections
    nodes.forEach((node, index) => {
      const angle = parseFloat(node.getAttribute('data-angle') || '0');
      const distance = parseFloat(node.getAttribute('data-distance') || '150');
      const radian = (angle * Math.PI) / 180;

      const x = centerX + Math.cos(radian) * distance;
      const y = centerY + Math.sin(radian) * distance;

      // Position node
      (node as HTMLElement).style.left = `${(x / 400) * 100}%`;
      (node as HTMLElement).style.top = `${(y / 400) * 100}%`;

      // Create connection line to center
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');

      // Create curved path
      const midX = (centerX + x) / 2;
      const midY = (centerY + y) / 2;
      const controlOffset = 20;
      const perpX = -(y - centerY) / distance * controlOffset;
      const perpY = (x - centerX) / distance * controlOffset;

      const d = `M ${centerX} ${centerY} Q ${midX + perpX} ${midY + perpY} ${x} ${y}`;

      line.setAttribute('d', d);
      line.setAttribute('class', 'signal-line');
      line.style.animationDelay = `${index * 0.5}s`;

      signalGroup.appendChild(line);
    });

    // Create data flow particles
    const particlesContainer = document.getElementById('data-particles');
    if (!particlesContainer) return;

    function createParticle() {
      const particle = document.createElement('div');
      particle.className = 'data-particle';

      // Random node to travel to
      const randomNode = nodes[Math.floor(Math.random() * nodes.length)] as HTMLElement;
      const color = randomNode.getAttribute('data-color') || '#EA242B';

      particle.style.background = color;
      particle.style.boxShadow = `0 0 8px ${color}`;

      // Start from center
      const startX = 50;
      const startY = 50;

      // End at node position
      const endX = parseFloat(randomNode.style.left);
      const endY = parseFloat(randomNode.style.top);

      particle.style.left = `${startX}%`;
      particle.style.top = `${startY}%`;

      particlesContainer.appendChild(particle);

      // Animate to node
      const duration = 1500 + Math.random() * 1000;

      particle.animate([
        { left: `${startX}%`, top: `${startY}%`, opacity: 0 },
        { left: `${startX}%`, top: `${startY}%`, opacity: 0.8, offset: 0.1 },
        { left: `${endX}%`, top: `${endY}%`, opacity: 0.8, offset: 0.9 },
        { left: `${endX}%`, top: `${endY}%`, opacity: 0 }
      ], {
        duration,
        easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
      }).onfinish = () => {
        particle.remove();
      };
    }

    // Spawn particles periodically
    setInterval(createParticle, 800);
    // Initial burst
    for (let i = 0; i < 3; i++) {
      setTimeout(createParticle, i * 200);
    }
  });
</script>
